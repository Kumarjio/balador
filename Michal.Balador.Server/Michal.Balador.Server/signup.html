<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <link href="css/animate.css" rel="stylesheet" />
    <link href="css/materialize.min.css" rel="stylesheet" />
    <link href="css/font-awesome.min.css" rel="stylesheet" />
    <script src="js/jquery-2.1.1.min.js"></script>
    <script src="js/materialize.js"></script>
    <script>
        var _d = [];
        $(function () {
            $(document).on('click', '#share form input[type=submit]', function (e) {
                e.preventDefault();
                debugger;
                //var idindex= $(this).data("index");
                //for (var item in _d){
                //    if (item.Id == idindex) {
                //        break;

                //    }
                //}
                var $form = $(this).parent();
                var formData = $form.serialize();
                $.ajax({
                    url: '/api/signup',
                    type: 'POST',
                    data: formData,
                    contentType: 'application/x-www-form-urlencoded',
                    success: function (got) {
                        debugger;
                        
                        return alert("shortened url: " + got.id);
                    }
                });
                //$.post("/api/signup", {
                //    formData
                // }, function (r) {
                //     debugger;
                //     alert('ok');
                // });
            });
            $.getJSON("/api/signup", function (data) {
                var items = [];
                $.each(data, function (key, val) {
                    _d.push(val);
                    //var $formToken = $('<form />', { action: '/api/setToken', method: 'POST', id: "frmToken_" + val.Id });
                    //var fTokenHidden = $('<input />', { name: 'formType', type: 'hidden', placeholder: 'Name', value: val.Id });
                    //var $fieldToken = $('<input />', { name: "txtToken", placeholder: "Write Token", type: 'text' });
                    //var btnValidate = $('<input />', { type: 'submit', value: 'Validate' });
                    //$form.append($formToken, fTokenHidden, $fieldToken, $('<br />'), btnValidate).appendTo($('#tokens'));
                    //$formToken.hide();

                    var $form = $('<form />', { action: '/api/signup', method: 'POST' });
                    var frmSave = $('<div />', { text: val.Message });
                    var frmRName = $('<input />', { name: 'formType', type: 'hidden', placeholder: 'Name', value: val.Id });
                    var frmButton = $('<input />', { type: 'submit', value: 'Apply' });
                    frmButton.data("index", val.Id);
                    var fields = val.Fields;
                    $div_container = $('<div  />', { class: 'container' });
                    $div_row = $('<div  />', { class: 'row' });
                    $div_container.append($div_row);
                    for (var i = 0; i < fields.length; i++) {
                        var field = fields[i];
                        var $fieldForm = $('<input />', { name: field.Name, placeholder: field.Title, type: 'text' });
                        $div_row.append($fieldForm, $('<br />'));
                    }
                    $form.append(frmSave, frmRName, $('<br />'), $div_container, frmButton).appendTo($('#share'));
                });


            });

        })
    </script>
</head>
<body>
    <div class="card-panel">
        <span class="blue-text text-darken-2">Signup ThirdParty Messangers</span>
    </div>
    <div class="container">

        <div class="row">
            <div id="share"></div>

        </div>
        <div class="row">
            <div id="tokens"></div>

        </div>
    </div>

</body>
</html>